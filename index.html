<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Catálogo de Productos</title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- Cabecera -->
<header class="bg-primary text-white py-3">
  <div class="container">
    <h1 class="h3">Mi Tienda Online</h1>
    <p class="mb-0">Productos de calidad al mejor precio</p>
  </div>
</header>

<!-- Contenido -->
<main class="container mt-4 mb-5">
  <!-- Búsqueda -->
  <div class="mb-4">
    <input type="text" id="searchInput" class="form-control" placeholder="Buscar por nombre o descripción...">
  </div>

  <!-- Categorías (se llenarán con JS) -->
  <div id="categoryFilters" class="mb-3"></div>

  <!-- Contador -->
  <div id="productCounter" class="mb-3 text-muted">
    Productos encontrados: <span id="count">0</span>
  </div>

  <!-- Productos -->
  <div id="productContainer" class="row"></div>

  <!-- Sin resultados -->
  <div id="noResults" class="text-center text-muted py-4" style="display: none;">
    No se encontraron productos que coincidan con tu búsqueda o categoría.
  </div>
</main>

<!-- Pie -->
<footer class="bg-dark text-light text-center py-3 mt-auto">
  <div class="container">
    <p class="mb-0">&copy; 2025 Mi Tienda Online. Todos los derechos reservados.</p>
  </div>
</footer>

<script>
// Configuración
const WHATSAPP_NUMBER = 'TU_NUMERO_WA'; // ⚠️ Reemplaza esto

// Estado
let productos = [];
let categorias = [];

// Elementos del DOM
const productContainer = document.getElementById('productContainer');
const categoryFilters = document.getElementById('categoryFilters');
const searchInput = document.getElementById('searchInput');
const countSpan = document.getElementById('count');
const noResultsDiv = document.getElementById('noResults');

// Cargar productos desde JSON
fetch('productos.json')
  .then(response => response.json())
  .then(data => {
    productos = data;
    categorias = [...new Set(productos.map(p => p.categoria).filter(Boolean))].sort();
    renderCategoryFilters();
    renderProducts();
  })
  .catch(err => {
    console.error('Error al cargar productos.json:', err);
    productContainer.innerHTML = '<div class="col-12"><div class="alert alert-danger">No se pudieron cargar los productos.</div></div>';
  });

// Renderizar botones de categoría
function renderCategoryFilters() {
  let html = `<button class="btn btn-outline-secondary btn-sm me-2 active" data-category="todos">Todas</button>`;
  categorias.forEach(cat => {
    html += `<button class="btn btn-outline-secondary btn-sm me-2" data-category="${cat.toLowerCase()}">${cat}</button>`;
  });
  categoryFilters.innerHTML = html;

  // Añadir eventos
  categoryFilters.querySelectorAll('button').forEach(btn => {
    btn.addEventListener('click', () => {
      categoryFilters.querySelectorAll('button').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      renderProducts();
    });
  });
}

// Renderizar productos (con filtros)
function renderProducts() {
  const searchTerm = searchInput.value.toLowerCase().trim();
  const activeCategory = categoryFilters.querySelector('.active').dataset.category;

  const filtered = productos.filter(producto => {
    const nombre = (producto.nombre || '').toLowerCase();
    const desc = (producto.descripcion || '').toLowerCase();
    const cat = (producto.categoria || '').toLowerCase();

    const matchSearch = !searchTerm || nombre.includes(searchTerm) || desc.includes(searchTerm);
    const matchCategory = activeCategory === 'todos' || cat === activeCategory;

    return matchSearch && matchCategory;
  });

  // Renderizar tarjetas
  productContainer.innerHTML = filtered.map(p => `
    <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
      <div class="card product-card h-100 shadow-sm">
        ${p.foto ? `<img src="img/${p.foto}" class="card-img-top" alt="${p.nombre || ''}">` : ''}
        <div class="card-body d-flex flex-column">
          <small class="text-muted">${p.categoria || 'Sin categoría'}</small>
          <h6 class="card-title">${p.nombre || 'Sin nombre'}</h6>
          <p class="card-text">${p.descripcion || ''}</p>
          <p class="card-text mt-auto"><strong>$${parseFloat(p.precio || 0).toLocaleString('es-ES', { minimumFractionDigits: 2 })}</strong></p>
          <a href="https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(`Hola, quiero comprar: ${p.nombre} ($${p.precio})`)})}"
             target="_blank" class="btn btn-success btn-sm mt-2">
            Comprar por WhatsApp
          </a>
        </div>
      </div>
    </div>
  `).join('');

  // Actualizar contador
  countSpan.textContent = filtered.length;
  noResultsDiv.style.display = filtered.length === 0 ? 'block' : 'none';
}

// Eventos
searchInput.addEventListener('input', renderProducts);
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
